<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Membuat Grafik Rasio Dokter Dari Data Web API</title>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

</head>
<body>

    <canvas id="canvas-untuk-menggambar-grafik"></canvas>

    <script>

        var grafik;

        function buatDataUntukGrafik(dataPenduduk, dataDokter) {

            // Kelas-kelas dan method terkait:
            // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map

            var labelPerWilayah = dataPenduduk.nilai_per_wilayah.map(function(satuanData) {
                return satuanData.wilayah;
            });

            var jumlahDokterPerWilayah = dataDokter.nilai_per_wilayah.map(function(satuanData) {
                return satuanData.nilai_per_tahun[0].nilai;
            }); 

            var jumlahPendudukPerWilayah = dataPenduduk.nilai_per_wilayah.map(function(satuanData) {
                return satuanData.nilai_per_tahun[0].nilai;
            }); 

            var rasioDokterPerWilayah = jumlahDokterPerWilayah.map(function(satuanData, urutan) {
                return jumlahDokterPerWilayah[urutan] / jumlahPendudukPerWilayah[urutan] * 1000;
            });

            var dataContoh = {
                labels: labelPerWilayah,
                datasets : [{
                    label: 'Jumlah Dokter',
                    backgroundColor: 'rgb(153, 102, 255)',
                    yAxisID: 'sumbu-y-kiri',
                    data: jumlahDokterPerWilayah
                }, {
                    label: 'Rasio Dokter / 1000 Penduduk',
                    backgroundColor: 'rgb(255, 159, 64)',
                    yAxisID: 'sumbu-y-kanan',
                    data: rasioDokterPerWilayah 
                }]
            } 

            return dataContoh;
        }

        function buatGrafik(dataPenduduk, dataDokter) {

            // Kelas-kelas terkait:
            // https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D
            // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement

            var elemenCanvas = document.getElementById("canvas-untuk-menggambar-grafik");
            var penggambarCanvas = elemenCanvas.getContext("2d");

            var judulGrafik = "Grafik Rasio Dokter Per 1000 Penduduk";
            var dataUntukGrafik = buatDataUntukGrafik(dataPenduduk, dataDokter);

            var konfigurasiChartJS = {
                type: 'bar',
                data: dataUntukGrafik,
                options: {
                    responsive: true,
                    title: {
                        display: true,
                        text: judulGrafik
                    },
                    scales: {
                        yAxes: [{
                            type: 'linear',
                            display: true,
                            position: 'left',
                            ticks: {
                                min: 0 
                            },
                            id: 'sumbu-y-kiri'
                        }, {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            ticks: {
                                min: 0 
                            },
                            id: 'sumbu-y-kanan'
                        }] 
                    }
                }
            };

            grafik = new Chart(penggambarCanvas, konfigurasiChartJS);

        }

        window.onload = function() {

            // Kelas-kelas terkait:
            // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise

            urlDataPenduduk = "https://mechaid.github.io/course-materials/praktikum-web/2020-2021/contoh/json-api-ke-chart/penduduk-jawa-barat-2019.json";
            urlDataDokter = "https://mechaid.github.io/course-materials/praktikum-web/2020-2021/contoh/json-api-ke-chart/dokter-jawa-barat-2019.json";

            var mintaDataPenduduk = axios.get(urlDataPenduduk);
            var mintaDataDokter = axios.get(urlDataDokter);

            Promise.all([mintaDataPenduduk, mintaDataDokter]).then(function(respon) {
                var dataPenduduk = respon[0].data;
                var dataDokter = respon[1].data;

                buatGrafik(dataPenduduk, dataDokter);

            });

        };
    </script>
</body>
</html>
